<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends Chatbot - Central Perk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            scroll-behavior: smooth;
        }
        .chat-container {
            max-height: 60vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #8B5CF6 #E5E7EB;
        }
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: #E5E7EB;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #8B5CF6;
            border-radius: 4px;
        }
        .character-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .character-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
        }
        .scroll-btn {
            transition: transform 0.2s ease-in-out;
        }
        .scroll-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <!-- Home Section -->
    <section id="home-section" class="min-h-screen flex items-center justify-center bg-cover bg-center" style="background-image: url('/static/images/download.jpg');">
        <div class="bg-white bg-opacity-80 rounded-lg shadow-xl p-8 max-w-2xl text-center">
            <h1 class="text-4xl font-bold text-purple-600 mb-4">Welcome to the F.R.I.E.N.D.S Chatbot!</h1>
            <p class="text-lg text-gray-700 mb-6">
                F.R.I.E.N.D.S is a lighthearted sitcom about six friends living in New York, juggling love, careers, and everyday chaos. With endless humor, heartwarming moments, and unforgettable catchphrases, it captures the highs and lows of adulting. From crazy roommates to on-again-off-again love stories, every episode feels like a warm hug. It’s the perfect mix of fun, friendship, and feel-good vibes that never gets old.
            </p>
            <a href="#character-section" class="scroll-btn inline-block bg-purple-600 text-white py-2 px-6 rounded-md hover:bg-purple-700">Scroll to Chat</a>
        </div>
    </section>

    <!-- Character Selection Section -->
    <section id="character-section" class="py-12 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center text-purple-600 mb-8">Who Do You Want to Chat With?</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                <!-- Chandler Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Chandler">
                    <img src="/static/images/chandler-bing.jpg" alt="Chandler Bing" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Chandler</h3>
                        <p class="text-gray-600">Sarcastic, witty, and always ready with a "Could I be more..." joke.</p>
                    </div>
                </div>
                <!-- Joey Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Joey">
                    <img src="/static/images/joey-tribbiani.jpg" alt="Joey Tribbiani" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Joey</h3>
                        <p class="text-gray-600">Goofy, charming, and loves to say "How you doin'?"</p>
                    </div>
                </div>
                <!-- Monica Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Monica">
                    <img src="/static/images/monica-geller.jpg" alt="Monica Geller" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Monica</h3>
                        <p class="text-gray-600">Competitive, meticulous, and a cleaning enthusiast.</p>
                    </div>
                </div>
                <!-- Ross Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Ross">
                    <img src="/static/images/ross-geller.jpg" alt="Ross Geller" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Ross</h3>
                        <p class="text-gray-600">Nerdy, sensitive, and obsessed with dinosaurs.</p>
                    </div>
                </div>
                <!-- Rachel Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Rachel">
                    <img src="/static/images/rachel-green.jpg" alt="Rachel Green" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Rachel</h3>
                        <p class="text-gray-600">Fashionable, charming, and a bit ditzy at times.</p>
                    </div>
                </div>
                <!-- Phoebe Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="Phoebe">
                    <img src="/static/images/phoebe-buffay.jpg" alt="Phoebe Buffay" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Phoebe</h3>
                        <p class="text-gray-600">Quirky, spiritual, and loves singing odd songs.</p>
                    </div>
                </div>
                <!-- General Chat (Bot) Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="None">
                    <img src="/static/images/bot.jpg" alt="General Chat" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">General Chat</h3>
                        <p class="text-gray-600">Chat with a Friends enthusiast for Central Perk banter!</p>
                    </div>
                </div>
                <!-- Generate New Dialogue Card -->
                <div class="character-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer" data-character="generate">
                    <img src="/static/images/central-perk.jpg" alt="Generate Dialogue" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-purple-600">Generate Dialogue</h3>
                        <p class="text-gray-600">Create a new Friends-style conversation!</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot Section -->
    <section id="chatbot-section" class="hidden min-h-screen flex items-center justify-center bg-cover bg-center" style="background-image: url('/static/images/central-perk.jpg');">
        <div class="container mx-auto p-4 max-w-2xl">
            <div class="bg-white rounded-lg shadow-xl p-6 bg-opacity-90 flex flex-col h-[80vh]">
                <!-- Header with Home Button -->
                <div class="flex justify-between items-center mb-4">
                    <h2 id="chatbot-title" class="text-2xl font-bold text-purple-600">Chatting with Chandler</h2>
                    <a href="#home-section" id="home-btn" class="bg-gray-500 text-white py-1 px-3 rounded-md hover:bg-gray-600">Home</a>
                </div>
                <!-- Topic Input for Generate Mode -->
                <div id="topic-container" class="mb-4 hidden">
                    <label for="topic" class="block text-sm font-medium text-gray-700">Dialogue Topic</label>
                    <input type="text" id="topic" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" placeholder="e.g., Central Perk conversation">
                    <label for="dialogue-character" class="block text-sm font-medium text-gray-700 mt-2">Character for Dialogue (optional)</label>
                    <select id="dialogue-character" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500">
                        <option value="None">None</option>
                        <option value="Chandler">Chandler</option>
                        <option value="Joey">Joey</option>
                        <option value="Monica">Monica</option>
                        <option value="Ross">Ross</option>
                        <option value="Rachel">Rachel</option>
                        <option value="Phoebe">Phoebe</option>
                    </select>
                    <button id="generate-btn" class="mt-4 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">Generate Dialogue</button>
                </div>
                <!-- Chat Area -->
                <div class="chat-container bg-gray-50 p-4 rounded-lg mb-4 flex-grow overflow-y-auto">
                    <div id="chat-area" class="space-y-4"></div>
                </div>
                <!-- Input and Send Button -->
                <div id="chat-input-container" class="flex items-center gap-2">
                    <input type="text" id="user-input" class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" placeholder="Say something to your Friends pal...">
                    <button id="send-btn" class="bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">Send</button>
                </div>
            </div>
        </div>
    </section>

    <script>
        const homeSection = document.getElementById('home-section');
        const characterSection = document.getElementById('character-section');
        const chatbotSection = document.getElementById('chatbot-section');
        const chatbotTitle = document.getElementById('chatbot-title');
        const topicContainer = document.getElementById('topic-container');
        const topicInput = document.getElementById('topic');
        const dialogueCharacterSelect = document.getElementById('dialogue-character');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const generateBtn = document.getElementById('generate-btn');
        const chatArea = document.getElementById('chat-area');
        const chatContainer = document.querySelector('.chat-container');
        const homeBtn = document.getElementById('home-btn');
        const characterCards = document.querySelectorAll('.character-card');

        let chatHistory = [];
        let currentCharacter = null;

        // Show Home Section by Default
        function showHome() {
            homeSection.classList.remove('hidden');
            characterSection.classList.remove('hidden');
            chatbotSection.classList.add('hidden');
            chatArea.innerHTML = ''; // Clear chat
            chatHistory = [];
            userInput.value = '';
            topicInput.value = '';
            currentCharacter = null;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show Chatbot Section with Selected Character
        function showChatbot(character) {
            homeSection.classList.add('hidden');
            characterSection.classList.add('hidden');
            chatbotSection.classList.remove('hidden');
            currentCharacter = character;
            chatbotTitle.textContent = character === 'generate' ? 'Generate New Dialogue' : character === 'None' ? 'General Chat' : `Chatting with ${character}`;
            if (character === 'generate') {
                topicContainer.classList.remove('hidden');
                userInput.parentElement.classList.add('hidden');
            } else {
                topicContainer.classList.add('hidden');
                userInput.parentElement.classList.remove('hidden');
            }
            window.scrollTo({ top: chatbotSection.offsetTop, behavior: 'smooth' });
        }

        // Handle Character Card Click
        characterCards.forEach(card => {
            card.addEventListener('click', () => {
                const character = card.getAttribute('data-character');
                showChatbot(character);
            });
        });

        // Handle Home Button Click
        homeBtn.addEventListener('click', showHome);

        // Handle Scroll to Chat Button
        document.querySelector('.scroll-btn').addEventListener('click', (e) => {
            e.preventDefault();
            characterSection.scrollIntoView({ behavior: 'smooth' });
        });

        // Send Message or Generate Dialogue
        async function sendMessage() {
            const character = currentCharacter;
            const userText = userInput.value.trim();
            const topic = topicInput.value.trim();
            const dialogueCharacter = dialogueCharacterSelect.value;

            if (character === 'generate' && !topic) {
                appendMessage('System', 'Please enter a topic for the dialogue!', 'text-red-600');
                return;
            }

            if (character !== 'generate' && !userText) {
                appendMessage('System', 'Please enter a message!', 'text-red-600');
                return;
            }

            appendMessage('You', userText || topic, 'text-blue-600');

            try {
                let response;
                if (character === 'generate') {
                    response = await fetch('/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            topic,
                            character: dialogueCharacter === 'None' ? null : dialogueCharacter
                        })
                    });
                } else {
                    response = await fetch('/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_input: userText,
                            character: character === 'None' ? null : character,
                            chat_history: chatHistory.slice(-3)
                        })
                    });
                }

                const data = await response.json();
                if (response.ok) {
                    const botResponse = data.response || 'Hmm, Central Perk’s out of coffee! Try again!';
                    appendMessage(character === 'None' ? 'Bot' : character, botResponse, 'text-purple-600');

                    // Update chat history for chat mode
                    if (character !== 'generate') {
                        chatHistory.push({ user: userText, bot: botResponse, character });
                        chatHistory = chatHistory.slice(-3);
                    }

                    // Reset input for chat mode
                    if (character !== 'generate') {
                        userInput.value = '';
                    }
                } else {
                    appendMessage('System', data.response || 'Error occurred!', 'text-red-600');
                }

                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            } catch (error) {
                appendMessage('System', 'Error connecting to Central Perk! Try again later.', 'text-red-600');
                console.error(error);
            }
        }

        // Handle Send Button Click
        sendBtn.addEventListener('click', sendMessage);

        // Handle Generate Button Click
        if (generateBtn) {
            generateBtn.addEventListener('click', sendMessage);
        }

        // Append Message to Chat Area
        function appendMessage(sender, message, colorClass) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `p-2 rounded-lg max-w-[80%] ${sender === 'You' ? 'bg-blue-100 ml-auto' : 'bg-purple-100'} ${colorClass}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message.replace(/\n/g, '<br>')}`;
            chatArea.appendChild(messageDiv);
        }

        // Handle Enter Key for Sending Messages
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        // Handle Enter Key for Generate Dialogue
        topicInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && currentCharacter === 'generate') {
                generateBtn.click();
            }
        });

        // Initialize Home View
        showHome();
    </script>
</body>
</html>